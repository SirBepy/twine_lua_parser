window.storyFormat({
  "name": "twine_lua_parser",
  "version": "0.0.2",
  "author": "SirBepy",
  "description": "Export your Twine 2 story as a lua file (RobloxStudio)",
  "proofing": false,
  "source": "<html>\r\n  <head>\r\n    <title>{{STORY_NAME}}</title>\r\n    <script type=\"text/javascript\">\r\n      const twine_lua_parser={};twine_lua_parser.extractLinksFromText=function(t){const n=t.match(/\\[\\[.+?\\]\\]/g);return n?n.map(function(t){const n=t.match(/\\[\\[(.*?)\\-\\&gt;(.*?)\\]\\]/);return n?{name:n[1],link:n[2]}:(t=t.substring(2,t.length-2),{name:t,link:t})}):null},twine_lua_parser.extractPropsFromText=function(t){const n={},e=/\\(set:\\s*\\$(\\w+)\\s*to\\s*\"([^\"]+)\"\\)/g;return t.text=t.text.replace(e,function(t,e,a){return n[e]=a,\"\"}),t.text=t.text.trim(),Object.keys(n).length>0?n:null},twine_lua_parser.convertPassage=function(t){const n={text:t.innerHTML},e=twine_lua_parser.extractLinksFromText(n.text);e&&(n.links=e);const a=twine_lua_parser.extractPropsFromText(n);return a&&(n.props=a),[\"name\",\"pid\",\"tags\"].forEach(function(e){const a=t.attributes[e].value;a&&(n[e]=a)}),n.tags&&(n.tags=n.tags.split(\" \")),n},twine_lua_parser.convertStory=function(t){const n=t.getElementsByTagName(\"tw-passagedata\"),e=Array.prototype.slice.call(n).map(twine_lua_parser.convertPassage),a={passages:e};[\"name\",\"startnode\"].forEach(function(n){const e=t.attributes[n].value;e&&(a[n]=e)});const r={};return a.passages.forEach(function(t){r[t.name]=t.pid}),a.passages.forEach(function(t){t.links&&t.links.forEach(function(t){t.pid=r[t.link]})}),a},twine_lua_parser.init=function(){const t=document.getElementsByTagName(\"tw-storydata\")[0],n=JSON.stringify(twine_lua_parser.convertStory(t),null,2);document.getElementById(\"output\").innerHTML=n},window.twine_lua_parser=twine_lua_parser;\r\n    </script>\r\n  </head>\r\n  <body>\r\n    <pre id=\"output\"></pre>\r\n    <div id=\"storyData\" style=\"display: none;\">\r\n      {{STORY_DATA}}\r\n    </div>\r\n    <script>\r\n      twine_lua_parser.init();\r\n    </script>\r\n  </body>\r\n</html>\r\n"
});