window.storyFormat({
  "name": "Twine to Lua parser",
  "version": "0.0.18",
  "author": "SirBepy",
  "description": "Export your Twine 2 story as a lua file (RobloxStudio)",
  "proofing": false,
  "source": "<html>\r\n\r\n<head>\r\n  <title>{{STORY_NAME}}</title>\r\n  <script type=\"text/javascript\">\r\n    { { SCRIPT } }\r\n  </script>\r\n  <style>\r\n    body,\r\n    html {\r\n      box-sizing: border-box;\r\n      margin: 0;\r\n      padding: 0;\r\n      background-color: #365486;\r\n      color: #7FC7D9;\r\n    }\r\n\r\n    body {\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: center;\r\n      align-items: center;\r\n      height: 100%;\r\n    }\r\n\r\n    #storyData {\r\n      display: none;\r\n    }\r\n\r\n    #output {\r\n      width: 500px;\r\n      height: 500px;\r\n      max-width: 80vw;\r\n      max-height: 80vh;\r\n      overflow-y: auto;\r\n      text-wrap: wrap;\r\n      opacity: 0.5;\r\n      padding: 1em;\r\n      border: #0F1035 4px solid;\r\n      border-radius: 10px;\r\n    }\r\n\r\n    #unrecognizedNames {\r\n      margin-top: 1em;\r\n      width: 500px;\r\n      max-width: 80vw;\r\n      padding: 1em;\r\n      border: #0F1035 4px solid;\r\n      border-radius: 10px;\r\n      background-color: #7FC7D9;\r\n      color: white;\r\n    }\r\n\r\n    #unrecognizedNames button {\r\n      margin-top: 0.5em;\r\n    }\r\n\r\n    button {\r\n      width: 180px;\r\n      height: 40px;\r\n      border-radius: 10px;\r\n      font-size: 1.2em;\r\n      background-color: #7FC7D9;\r\n      color: white;\r\n      border: #DCF2F1 1px solid;\r\n      transition: 0.2s;\r\n      cursor: pointer;\r\n    }\r\n\r\n    button:hover {\r\n      opacity: 0.5;\r\n    }\r\n\r\n    button:active {\r\n      opacity: 0.2;\r\n    }\r\n\r\n    button:disabled {\r\n      opacity: 1;\r\n    }\r\n  </style>\r\n</head>\r\n\r\n<body>\r\n  <button onclick=\"copyText()\">Copy output</button>\r\n  <pre id=\"output\"></pre>\r\n  <div id=\"unrecognizedNames\"></div>\r\n  <div id=\"storyData\">\r\n    {{STORY_DATA}}\r\n  </div>\r\n  <script>\r\n    const recognizedNames = JSON.parse(localStorage.getItem(\"recognizedNames\") || \"[]\");\r\n\r\n    function displayUnrecognizedNames(names) {\r\n      const unrecognizedDiv = document.getElementById(\"unrecognizedNames\");\r\n      unrecognizedDiv.innerHTML = \"<h3>Unrecognized Names:</h3>\";\r\n\r\n      names.forEach(name => {\r\n        const nameDiv = document.createElement(\"div\");\r\n        nameDiv.textContent = name;\r\n\r\n        const addButton = document.createElement(\"button\");\r\n        addButton.textContent = \"Add to Names\";\r\n        addButton.onclick = () => addToRecognizedNames(name);\r\n\r\n        const correctButton = document.createElement(\"button\");\r\n        correctButton.textContent = \"Flag as Error\";\r\n        correctButton.onclick = () => alert(`Correct or verify the spelling of: ${name}`);\r\n\r\n        nameDiv.appendChild(addButton);\r\n        nameDiv.appendChild(correctButton);\r\n        unrecognizedDiv.appendChild(nameDiv);\r\n      });\r\n    }\r\n\r\n    function addToRecognizedNames(name) {\r\n      recognizedNames.push(name);\r\n      localStorage.setItem(\"recognizedNames\", JSON.stringify(recognizedNames));\r\n      alert(`${name} added to recognized names.`);\r\n      parseTwineToLua(); // Re-run to remove recognized names from the list\r\n    }\r\n\r\n    function findUnrecognizedNames(text) {\r\n      const nameRegex = /@(\\w+)/g;\r\n      const matches = [...text.matchAll(nameRegex)].map(match => match[1]);\r\n      const unrecognized = matches.filter(name => !recognizedNames.includes(name));\r\n      displayUnrecognizedNames(unrecognized);\r\n    }\r\n\r\n    function copyText() {\r\n      const textToCopy = document.getElementById(\"output\").innerText;\r\n      const textarea = document.createElement(\"textarea\");\r\n      textarea.value = textToCopy;\r\n\r\n      document.body.appendChild(textarea);\r\n      textarea.select();\r\n      document.execCommand('copy');\r\n      document.body.removeChild(textarea);\r\n\r\n      const button = document.querySelector('button');\r\n      button.textContent = 'Copied to clipboard';\r\n      button.disabled = true\r\n\r\n      setTimeout(() => {\r\n        button.textContent = 'Copy output';\r\n        button.disabled = false\r\n      }, 1500);\r\n    }\r\n\r\n    parseTwineToLua();\r\n    findUnrecognizedNames(document.getElementById(\"output\").innerText);\r\n  </script>\r\n</body>\r\n\r\n</html>\r\n/html>"
});